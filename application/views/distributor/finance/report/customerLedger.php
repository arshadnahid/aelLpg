<?phpif (isset($_POST['start_date'])):    $customerid = $this->input->post('customerid');    $from_date = $this->input->post('start_date');    $to_date = $this->input->post('end_date');endif;?><div class="main-content">    <div class="main-content-inner">        <div class="breadcrumbs ace-save-state  noPrint" id="breadcrumbs">            <ul class="breadcrumb">                <li>                    <i class="ace-icon fa fa-home home-icon"></i>                    <a href="<?php echo site_url('DistributorDashboard/1'); ?>">Finance</a>                </li>                <li class="active">Customer Ledger</li>            </ul>            <ul class="breadcrumb pull-right">                <li class="active">                    <i class="ace-icon fa fa-list"></i>                    <a href="<?php echo site_url('DistributorDashboard/1'); ?>">List</a>                </li>            </ul>        </div>        <br>        <div class="page-content">            <div class="row  noPrint">                <div class="col-md-12">                    <form id="publicForm" action=""  method="post" class="form-horizontal">                        <div class="col-sm-10 col-md-offset-1">                            <div class="table-header">                                Customer Ledger                            </div>                            <br>                            <div style="background-color: grey!important;">                                <div class="col-md-4">                                    <div class="form-group">                                        <label class="col-sm-4 control-label no-padding-right" for="form-field-1"> Customer</label>                                        <div class="col-sm-8">                                            <select  name="customerid" class="chosen-select form-control" id="form-field-select-3" data-placeholder="Search by customer"  onchange="check_pretty_cash(this.value)">                                                <option  <?phpif (!empty($customerid) && $customerid == 'all') {    echo "selected";}?>  value="all">All</option>                                                    <?php foreach ($customerList as $eachInfo): ?>                                                    <option <?php                                                    if (!empty($customerid) && $customerid == $eachInfo->customer_id) {                                                        echo "selected";                                                    }                                                        ?> value="<?php echo $eachInfo->customer_id; ?>"><?php echo $eachInfo->customerName; ?>[<?php echo $eachInfo->customerID; ?>]</option>                                                    <?php endforeach; ?>                                            </select>                                        </div>                                    </div>                                </div>                                <div class="col-md-3">                                    <div class="form-group">                                        <label class="col-sm-4 control-label no-padding-right" for="form-field-1"> From Date</label>                                        <div class="col-sm-8">                                            <input type="text"class="date-picker" id="start_date" name="start_date" value="<?php                                                    if (!empty($from_date)) {                                                        echo $from_date;                                                    } else {                                                        echo date('d-m-Y');                                                    }                                                    ?>" data-date-format='dd-mm-yyyy' placeholder="Start Date: dd-mm-yyyy"/>                                        </div>                                    </div>                                </div>                                <div class="col-md-3">                                    <div class="form-group">                                        <label class="col-sm-4 control-label no-padding-right" for="form-field-1"> To Date</label>                                        <div class="col-sm-8">                                            <input type="text" class="date-picker" id="end_date" name="end_date" value="<?php                                                   if (!empty($to_date)):                                                       echo $to_date;                                                   else:                                                       echo date('d-m-Y');                                                   endif;                                                    ?>" data-date-format='dd-mm-yyyy' placeholder="End Date: dd-mm-yyyy"/>                                        </div>                                    </div>                                </div>                                <div class="col-md-2">                                    <div class="form-group">                                        <div class="col-sm-6">                                            <button type="submit" class="btn btn-success btn-sm">                                                <span class="ace-icon fa fa-search icon-on-right bigger-110"></span>                                                Search                                            </button>                                        </div>                                        <div class="col-sm-6">                                            <button type="button" class="btn btn-info btn-sm"  onclick="window.print();" style="cursor:pointer;">                                                <i class="ace-icon fa fa-print  align-top bigger-125 icon-on-right"></i>                                                Print                                            </button>                                        </div>                                    </div>                                </div>                            </div>                        </div>                        <div class="clearfix"></div>                    </form>                </div>            </div><!-- /.col -->            <?php            if (isset($_POST['start_date']) && isset($_POST['end_date'])) :                // dumpVar($_POST);                $customer_id = $this->input->post('customerid');                $from = date('Y-m-d', strtotime($this->input->post('start_date')));                $to = date('Y-m-d', strtotime($this->input->post('end_date')));                unset($_SESSION["customerid"]);                unset($_SESSION["start_date"]);                unset($_SESSION["end_date"]);                $_SESSION["customerid"] = $customer_id;                $_SESSION["start_date"] = $from;                $_SESSION["end_date"] = $to;                $dist_id = $this->dist_id;                if ($customer_id != 'all'):                    ?>                    <div class="row">                        <div class="col-sm-10 col-md-offset-1">                            <div class="table-header">                                Customer Ledger <span style="color:greenyellow;">From <?php echo $from; ?> To <?php echo $to; ?></span>                            </div>                            <!--                            <div class="noPrint">                                                        <a style="border-radius:100px 0 100px 0;" href="<?php echo site_url('FinaneController/customerLedger_export_excel/') ?>" class="btn btn-success pull-right">                                                            <i class="ace-icon fa fa-download"></i>                                                            Excel                                                        </a></div>-->                            <table class="table table-responsive">                                <tr>                                    <td style="text-align:center;">                                        <h3><?php echo $companyInfo->companyName; ?>.</h3>                                        <span><?php echo $companyInfo->address; ?></span><br>                                        <strong>Phone : </strong><?php echo $companyInfo->phone; ?><br>                                        <strong>Email : </strong><?php echo $companyInfo->email; ?><br>                                        <strong>Website : </strong><?php echo $companyInfo->website; ?><br>                                        <strong><?php echo $pageTitle; ?></strong>                                    </td>                                </tr>                            </table>                            <table class="table table-bordered">                                <thead>                                    <tr>                                        <td align="center"><strong>SL</strong></td>                                        <td align="center"><strong>Date</strong></td>                                        <td align="center"><strong>Voucher No</strong></td>                                        <td align="center"><strong>Type</strong></td>                                                                                                            <!--<td align="center"><strong>Charge</strong></td>-->                                        <td align="center"><strong>Receivable (+)</strong></td>                                        <td align="center"><strong>Received (-)</strong></td>                                        <td align="center"><strong>Due</strong></td>                                    </tr>                                </thead>                                <tbody>                                    <tr>                                        <td colspan="6" align="right"><strong>Opening Balance (In BDT.)</strong></td>                                        <td align="right"><?php            $custoOpe = $this->Finane_Model->getCusOpe($customer_id, $from, $dist_id);            echo number_format((float) $custoOpe, 2, '.', ',');                    ?></td>                                    </tr>                                    <?php                                    $dr='';                                    $cr='';                                    $tdr='';                                    $tcr='';                                    $query = $this->Finane_Model->customer_ledger($customer_id, $from, $to, $dist_id);                                    foreach ($query as $key => $row):                                        ?>                                        <tr>                                            <td><?php echo $key + 1; ?></td>                                            <td><?php echo date('M d, Y', strtotime($row['date'])); ?></td>                                            <td align="left"><?php echo $row['trans_type']; ?></td>                                            <!--<td align="left"><?php echo $this->Common_model->tableRow('generals', 'generals_id', $row['history_id'])->voucher_no; ?></td>-->                                            <td align="left"><?php echo $row['paymentType']; ?></td>                                            <td align="right"><?php                                        $dr += $row['dr'];                                        $tdr += $row['dr'];                                        echo number_format((float) $row['dr'], 2, '.', ',');                                        ?></td>                                            <td align="right"><?php $cr += $row['cr']; $tcr += $row['cr']; echo number_format((float) $row['cr'], 2, '.', ',');                                        ?></td>                                            <td align="right"><?php  echo number_format((float) ($dr - $cr)+$custoOpe, 2, '.', ',');?></td>                                        </tr>                                    <?php endforeach; ?>                                </tbody>                                <tfoot>                                    <tr>                                        <td colspan="4" align="right"><strong>Total (In BDT.)</strong></td>                                        <td align="right"><strong><?php echo number_format((float) $tdr, 2, '.', ','); ?></strong></td>                                        <td align="right"><strong> <?php echo number_format((float) $tcr, 2, '.', ','); ?></strong></td>                                        <td align="right"><strong> <?php                            echo number_format((float) ($dr - $cr)+$custoOpe, 2, '.', ',');                           // $finalAmount = ($dr - $cr)+$custoOpe;                                    ?></strong></td>                                    </tr>                                </tfoot>                            </table>                            <br>                        </div>                    </div>                <?php else:                    ?>                    <div class="row">                        <div class="col-sm-10 col-md-offset-1">                            <div class="table-header">                                Customer Ledger <span style="color:greenyellow;">From <?php echo $from_date; ?> To <?php echo $to_date; ?></span>                            </div>                            <!--                            <div class="noPrint">                                                        <a style="border-radius:100px 0 100px 0;" href="<?php echo site_url('FinaneController/customerLedger_export_excel/') ?>" class="btn btn-success pull-right">                                                            <i class="ace-icon fa fa-download"></i>                                                            Excel                                                        </a>                                                        </div>-->                            <table class="table table-responsive">                                <tr>                                    <td style="text-align:center;">                                        <h3><?php echo $companyInfo->companyName; ?>.</h3>                                        <span><?php echo $companyInfo->address; ?></span><br>                                        <strong>Phone : </strong><?php echo $companyInfo->phone; ?><br>                                        <strong>Email : </strong><?php echo $companyInfo->email; ?><br>                                        <strong>Website : </strong><?php echo $companyInfo->website; ?><br>                                        <strong><?php echo $pageTitle; ?></strong>                                    </td>                                </tr>                            </table>                            <table class="table table-bordered">                                <thead>                                    <tr>                                        <td align="center"><strong>SL</strong></td>                                        <td align="center"><strong>Name</strong></td>                                        <td align="center"><strong>Address</strong></td>                                        <td align="center"><strong>Contact Number</strong></td>                                        <td align="center"><strong>Opening Balance</strong></td>                                        <td align="center"><strong>Receivable (+)</strong></td>                                        <td align="center"><strong>Received (-)</strong></td>                                        <td align="center"><strong>Due</strong></td>                                    </tr>                                </thead>                                <tbody>                                    <?php                                    $ttopen = 0;                                    $ttdrebit = 0;                                    $ttcredit = 0;                                    $sl=1;                                    foreach ($customerList as $key => $eachCust):                                        $customerBal = $this->Finane_Model->getCustomerSummation($eachCust->customer_id, $from, $to, $dist_id);                                        if (!empty($customerBal['opening']) || !empty($customerBal['debit']) || !empty($customerBal['credit'])):                                            ?>                                            <tr>                                                <td><?php echo $sl++; ?></td>                                                <td align="left">                                                    <a title="View Customer Dashboard" href="<?php echo site_url('customerDashboard/' . $eachCust->customer_id); ?>"><?php echo $eachCust->customerID . ' [ ' . $eachCust->customerName . ' ] '; ?></a>                                                </td>                                                <td align="center"><?php echo $eachCust->address; ?></td>                                                <td align="center"><?php echo $eachCust->mobile; ?></td>                                                <td align="right"><?php                                                echo number_format((float) $customerBal['opening'], 2, '.', ',');                            $ttopen+= $customerBal['opening'];                                            ?></td>                                                <td align="right"><?php                                                echo number_format((float) $customerBal['debit'], 2, '.', ',');                                    $ttdrebit+= $customerBal['debit'];                                            ?></td>                                                <td align="right"><?php                                                 echo number_format((float) $customerBal['credit'], 2, '.', ',');                                    $ttcredit+=$customerBal['credit'];                                            ?></td>                                                <td align="right"><?php echo number_format(($customerBal['opening'] + $customerBal['debit']) - $customerBal['credit']); ?></td>                                            </tr>                                            <?php                                        endif;                                    endforeach;                                    ?>                                </tbody>                                <tfoot>                                    <tr>                                        <td colspan="4" align="right"><strong>Total (In BDT.)</strong></td>                                        <!--<td align="right"><strong><?php //echo number_format((float) $ttopen, 2, '.', ',');                                                               ?></strong></td>-->                                        <td align="right"><strong><?php echo number_format((float) $ttopen, 2, '.', ','); ?></strong></td>                                        <td align="right"><strong><?php echo number_format((float) $ttdrebit, 2, '.', ','); ?></strong></td>                                        <td align="right"><strong> <?php echo number_format((float) $ttcredit, 2, '.', ','); ?></strong></td>                                        <td align="right"><strong> <?php echo number_format((float) ($ttdrebit - $ttcredit) + $ttopen, 2, '.', ','); ?></strong></td>                                    </tr>                                </tfoot>                            </table>                        </div>                    </div>                <?php                endif;            endif;            ?>        </div><!-- /.row -->    </div><!-- /.page-content --></div>